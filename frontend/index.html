<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Task Priority</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f4f6fb;
      color: #222;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }

    /* AUTH CARD */
    .auth-wrapper {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .auth-card {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.08);
      padding: 2rem 2.5rem;
      max-width: 480px;
      width: 100%;
    }
    .auth-title {
      text-align: center;
      margin: 0;
      font-size: 2rem;
      color: #2563eb;
    }
    .auth-subtitle {
      text-align: center;
      font-size: 0.95rem;
      color: #6b7280;
      margin-top: 0.3rem;
      margin-bottom: 1.5rem;
    }
    .auth-tabs {
      display: flex;
      border-radius: 999px;
      background: #e5e7eb;
      padding: 0.2rem;
      margin-bottom: 1.2rem;
    }
    .auth-tab {
      flex: 1;
      text-align: center;
      padding: 0.5rem 0;
      border-radius: 999px;
      font-size: 0.9rem;
      cursor: pointer;
      user-select: none;
      color: #4b5563;
    }
    .auth-tab.active {
      background: #fff;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
      color: #111827;
      font-weight: 600;
    }
    .auth-label {
      font-size: 0.85rem;
      font-weight: 600;
      color: #4b5563;
      margin-top: 0.8rem;
      display: block;
    }
    .auth-input {
      width: 100%;
      margin-top: 0.3rem;
      padding: 0.55rem 0.7rem;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      font-size: 0.9rem;
    }
    .auth-helper {
      font-size: 0.75rem;
      color: #6b7280;
      margin-top: 0.3rem;
    }
    .auth-btn {
      width: 100%;
      margin-top: 1.2rem;
      padding: 0.65rem 0.9rem;
      border-radius: 999px;
      border: none;
      background: #2563eb;
      color: #fff;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
    }
    .auth-btn:active {
      transform: translateY(1px);
    }

    /* MAIN APP (hidden at start) */
    .app-hidden {
      display: none;
    }
    header {
      background: #4a6cf7;
      color: #fff;
      padding: 1rem 1.5rem;
    }
    header h1 {
      margin: 0;
      font-size: 1.5rem;
    }
    .app-container {
      display: flex;
      flex-wrap: wrap;
      padding: 1rem;
      gap: 1rem;
    }
    .panel {
      background: #fff;
      border-radius: 8px;
      padding: 1rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      flex: 1 1 320px;
      min-width: 280px;
    }
    h2 {
      margin-top: 0;
      font-size: 1.1rem;
    }
    label {
      display: block;
      margin-top: 0.5rem;
      font-size: 0.9rem;
    }
    input, select, textarea {
      width: 100%;
      padding: 0.45rem 0.6rem;
      margin-top: 0.2rem;
      border-radius: 4px;
      border: 1px solid #ccc;
      font-size: 0.9rem;
    }
    textarea {
      resize: vertical;
      min-height: 80px;
    }
    button {
      margin-top: 0.7rem;
      padding: 0.5rem 0.9rem;
      border-radius: 4px;
      border: none;
      background: #4a6cf7;
      color: #fff;
      font-size: 0.9rem;
      cursor: pointer;
    }
    button:disabled {
      opacity: 0.6;
      cursor: default;
    }
    .tasks-list {
      margin-top: 0.8rem;
      max-height: 300px;
      overflow-y: auto;
    }
    .task-item {
      border: 1px solid #e0e0e0;
      border-left-width: 4px;
      border-radius: 4px;
      padding: 0.5rem;
      margin-bottom: 0.5rem;
      font-size: 0.85rem;
    }
    .priority-high { border-left-color: #e53935; background: #ffebee; }
    .priority-medium { border-left-color: #fb8c00; background: #fff3e0; }
    .priority-low { border-left-color: #43a047; background: #e8f5e9; }

    .tag {
      display: inline-block;
      padding: 0.1rem 0.3rem;
      border-radius: 4px;
      font-size: 0.7rem;
      margin-right: 0.25rem;
      background: #e3f2fd;
      color: #1976d2;
    }
    .error {
      color: #d32f2f;
      font-size: 0.85rem;
      margin-top: 0.3rem;
    }
    .status {
      font-size: 0.85rem;
      margin-top: 0.3rem;
    }
    .status.loading { color: #1976d2; }
    .status.ok { color: #388e3c; }
    .status.fail { color: #d32f2f; }

    @media (max-width: 768px) {
      body { align-items: flex-start; padding-top: 2rem; }
      .app-container { flex-direction: column; }
    }
  </style>
</head>
<body>

  <!-- AUTH SCREEN -->
  <div id="auth-screen" class="auth-wrapper">
    <div class="auth-card">
      <h1 class="auth-title">Task Priority</h1>
      <p class="auth-subtitle">Smart task prioritization made simple</p>

      <div class="auth-tabs">
        <div id="tab-signin" class="auth-tab active">Sign In</div>
        <div id="tab-signup" class="auth-tab">Sign Up</div>
      </div>

      <label class="auth-label">Email</label>
      <input class="auth-input" type="email" placeholder="you@example.com" />

      <label class="auth-label">Password</label>
      <input class="auth-input" type="password" placeholder="********" />
      <div class="auth-helper">Password must be at least 6 characters</div>

      <button id="auth-btn" class="auth-btn">Sign In</button>
    </div>
  </div>

  <!-- MAIN APP -->
  <div id="app-screen" class="app-hidden" style="width:100%;">
    <header>
      <h1>Smart Task Analyser</h1>
    </header>
    <div class="app-container">
      <section class="panel">
        <h2>Input Tasks</h2>
        <div id="input-form">
          <label>Title
            <input type="text" id="title" placeholder="Fix login bug" />
          </label>
          <label>Due Date
            <input type="date" id="due_date" />
          </label>
          <label>Estimated Hours
            <input type="number" id="estimated_hours" min="0" step="0.25" />
          </label>
          <label>Importance (1-10)
            <input type="number" id="importance" min="1" max="10" value="5" />
          </label>
          <label>Dependencies (comma-separated IDs of existing tasks)
            <input type="text" id="dependencies" placeholder="task_0, task_2" />
          </label>
          <button id="add-task-btn">Add Task</button>
          <div class="error" id="input-error"></div>
        </div>

        <h3 style="margin-top:1rem;">Bulk JSON Input</h3>
        <label>Paste JSON array of tasks
          <textarea id="json-input" placeholder='[{"title": "Fix login bug", "due_date": "2025-11-30", "estimated_hours": 3, "importance": 8, "dependencies": []}]'></textarea>
        </label>
        <button id="load-json-btn">Load JSON Tasks</button>
        <div class="error" id="json-error"></div>

        <h3 style="margin-top:1rem;">Current Draft Tasks</h3>
        <div class="tasks-list" id="draft-tasks"></div>
      </section>

      <section class="panel">
        <h2>Analyse & Results</h2>
        <label>Strategy
          <select id="strategy">
            <option value="smart_balance">Smart Balance</option>
            <option value="fastest_wins">Fastest Wins</option>
            <option value="high_impact">High Impact</option>
            <option value="deadline_driven">Deadline Driven</option>
          </select>
        </label>
        <button id="analyze-btn">Analyze Tasks</button>
        <div class="status" id="status-msg"></div>

        <h3 style="margin-top:1rem;">Top 3 for Today</h3>
        <div class="tasks-list" id="top3"></div>

        <h3 style="margin-top:1rem;">All Tasks (Sorted)</h3>
        <div class="tasks-list" id="all-results"></div>
      </section>
    </div>
  </div>

  <script>
    /* SIMPLE AUTH SCREEN TOGGLE (no real backend auth) */
    const authScreen = document.getElementById("auth-screen");
    const appScreen = document.getElementById("app-screen");
    const tabSignin = document.getElementById("tab-signin");
    const tabSignup = document.getElementById("tab-signup");
    const authBtn = document.getElementById("auth-btn");

    tabSignin.addEventListener("click", () => {
      tabSignin.classList.add("active");
      tabSignup.classList.remove("active");
      authBtn.textContent = "Sign In";
    });

    tabSignup.addEventListener("click", () => {
      tabSignup.classList.add("active");
      tabSignin.classList.remove("active");
      authBtn.textContent = "Create Account";
    });

    authBtn.addEventListener("click", () => {
      // Just show main app, no real validation
      authScreen.style.display = "none";
      appScreen.classList.remove("app-hidden");
    });

    /* TASK ANALYSER LOGIC (same as before) */
    const API_BASE = "http://127.0.0.1:8000/api";
    let localTasks = [];

    const titleInput = document.getElementById("title");
    const dueInput = document.getElementById("due_date");
    const hoursInput = document.getElementById("estimated_hours");
    const importanceInput = document.getElementById("importance");
    const depsInput = document.getElementById("dependencies");
    const addBtn = document.getElementById("add-task-btn");
    const draftList = document.getElementById("draft-tasks");
    const inputError = document.getElementById("input-error");

    const jsonInput = document.getElementById("json-input");
    const loadJsonBtn = document.getElementById("load-json-btn");
    const jsonError = document.getElementById("json-error");

    const strategySelect = document.getElementById("strategy");
    const analyzeBtn = document.getElementById("analyze-btn");
    const statusMsg = document.getElementById("status-msg");
    const top3Div = document.getElementById("top3");
    const allResultsDiv = document.getElementById("all-results");

    function renderDraftTasks() {
      draftList.innerHTML = "";
      if (localTasks.length === 0) {
        draftList.innerHTML = "<em>No tasks added yet.</em>";
        return;
      }
      localTasks.forEach((t) => {
        const div = document.createElement("div");
        div.className = "task-item priority-low";
        div.innerHTML = `
          <div><strong>${t.id}</strong> - ${t.title}</div>
          <div>Due: ${t.due_date || "N/A"} | Hours: ${t.estimated_hours ?? "N/A"} | Importance: ${t.importance ?? "N/A"}</div>
          <div>Deps: ${(t.dependencies || []).join(", ") || "None"}</div>
        `;
        draftList.appendChild(div);
      });
    }

    addBtn.addEventListener("click", () => {
      inputError.textContent = "";
      const title = titleInput.value.trim();
      if (!title) {
        inputError.textContent = "Title is required.";
        return;
      }
      const due_date = dueInput.value ? dueInput.value : null;
      const estimated_hours = hoursInput.value ? parseFloat(hoursInput.value) : null;
      const importanceRaw = importanceInput.value ? parseInt(importanceInput.value, 10) : null;

      if (importanceRaw !== null && (importanceRaw < 1 || importanceRaw > 10)) {
        inputError.textContent = "Importance must be between 1 and 10.";
        return;
      }

      const depsRaw = depsInput.value.trim();
      let dependencies = [];
      if (depsRaw) {
        dependencies = depsRaw.split(",").map(d => d.trim()).filter(Boolean);
      }

      const id = "task_" + localTasks.length;
      const newTask = {
        id,
        title,
        due_date,
        estimated_hours,
        importance: importanceRaw !== null ? importanceRaw : undefined,
        dependencies
      };
      localTasks.push(newTask);

      titleInput.value = "";
      dueInput.value = "";
      hoursInput.value = "";
      importanceInput.value = "5";
      depsInput.value = "";

      renderDraftTasks();
    });

    loadJsonBtn.addEventListener("click", () => {
      jsonError.textContent = "";
      const text = jsonInput.value.trim();
      if (!text) {
        jsonError.textContent = "Please paste JSON array.";
        return;
      }
      try {
        const arr = JSON.parse(text);
        if (!Array.isArray(arr)) {
          jsonError.textContent = "JSON must be an array of tasks.";
          return;
        }
        arr.forEach((t) => {
          const id = t.id || "task_" + localTasks.length;
          localTasks.push({
            id,
            title: t.title || ("Untitled " + id),
            due_date: t.due_date || null,
            estimated_hours: typeof t.estimated_hours === "number" ? t.estimated_hours : null,
            importance: typeof t.importance === "number" ? t.importance : undefined,
            dependencies: Array.isArray(t.dependencies) ? t.dependencies : []
          });
        });
        renderDraftTasks();
      } catch (e) {
        jsonError.textContent = "Invalid JSON: " + e.message;
      }
    });

    function priorityClass(score) {
      if (score >= 0.7) return "priority-high";
      if (score >= 0.4) return "priority-medium";
      return "priority-low";
    }

    function renderResults(data) {
      const tasks = data.tasks || [];
      allResultsDiv.innerHTML = "";
      top3Div.innerHTML = "";
      if (tasks.length === 0) {
        allResultsDiv.innerHTML = "<em>No tasks in result.</em>";
        top3Div.innerHTML = "<em>No tasks in result.</em>";
        return;
      }
      tasks.forEach((t) => {
        const div = document.createElement("div");
        div.className = "task-item " + priorityClass(t.score);
        const warnings = (t.warnings || []).map(w => `<span class="tag">${w}</span>`).join(" ");
        div.innerHTML = `
          <div><strong>${t.title}</strong> <span class="tag">Score: ${t.score}</span> <span class="tag">${t.strategy_used}</span></div>
          <div>Due: ${t.due_date || "N/A"} | Hours: ${t.estimated_hours ?? "N/A"} | Importance: ${t.importance}</div>
          <div>Deps: ${(t.dependencies || []).join(", ") || "None"}</div>
          <div>${t.explanation}</div>
          <div>${warnings}</div>
        `;
        allResultsDiv.appendChild(div);
      });

      tasks.slice(0, 3).forEach((t) => {
        const div = document.createElement("div");
        div.className = "task-item " + priorityClass(t.score);
        div.innerHTML = `
          <div><strong>${t.title}</strong> <span class="tag">Score: ${t.score}</span></div>
          <div>${t.explanation}</div>
        `;
        top3Div.appendChild(div);
      });
    }

    analyzeBtn.addEventListener("click", () => {
      statusMsg.textContent = "";
      statusMsg.className = "status";
      if (localTasks.length === 0) {
        statusMsg.textContent = "Add at least one task before analyzing.";
        statusMsg.classList.add("fail");
        return;
      }
      const strategy = strategySelect.value;
      const payload = {
        strategy,
        tasks: localTasks.map(t => ({
          id: t.id,
          title: t.title,
          due_date: t.due_date,
          estimated_hours: t.estimated_hours,
          importance: t.importance,
          dependencies: t.dependencies
        }))
      };

      analyzeBtn.disabled = true;
      statusMsg.textContent = "Analyzing...";
      statusMsg.classList.add("loading");

      fetch(API_BASE + "/tasks/analyze/", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
      })
        .then(res => res.json().then(body => ({ ok: res.ok, body })))
        .then(({ ok, body }) => {
          analyzeBtn.disabled = false;
          if (!ok) {
            statusMsg.textContent = body.detail || "Error analyzing tasks.";
            statusMsg.classList.add("fail");
            return;
          }
          statusMsg.textContent = "Analysis complete.";
          statusMsg.classList.add("ok");
          renderResults(body);
        })
        .catch(err => {
          analyzeBtn.disabled = false;
          statusMsg.textContent = "Network error: " + err.message;
          statusMsg.classList.add("fail");
        });
    });

    renderDraftTasks();
  </script>
</body>
</html>
